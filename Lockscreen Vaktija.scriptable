{
  "always_run_in_app" : false,
  "icon" : {
    "color" : "orange",
    "glyph" : "unlock-alt"
  },
  "name" : "Lockscreen Vaktija",
  "script" : "const API_URL = \"https:\/\/api.vaktija.ba\/vaktija\/v1\/\";\nconst CITY = \"77\";\nconst FILE_PATH = \"vaktija.json\";\nconst fm = FileManager.iCloud();\nconst file = fm.joinPath(fm.documentsDirectory(), FILE_PATH);\n\nasync function fetchData() {\n    let req = new Request(API_URL + CITY);\n    let data = await req.loadJSON();\n    let now = new Date();\n    let fetchDate = now.toISOString().split(\"T\")[0];\n\n    fm.writeString(file, JSON.stringify({ data, fetchDate }));\n    return { data };\n}\n\nfunction loadStoredData() {\n    if (fm.fileExists(file)) {\n        let stored = JSON.parse(fm.readString(file));\n        let today = new Date().toISOString().split(\"T\")[0];\n        if (stored.fetchDate === today) return stored;\n    }\n    return null;\n}\n\nasync function getVaktija() {\n    let storedData = loadStoredData();\n    return storedData ? storedData : await fetchData();\n}\n\nfunction getNextVakat(vakatTimes) {\n    let now = new Date();\n    let times = [\"Zora\", \"Izlazak\", \"Podne\", \"Ikindija\", \"Akšam\", \"Jacija\"];\n    let icons = [\"🕌\", \"🌅\", \"☀️\", \"🌤\", \"🌇\", \"🌙\"];\n\n    for (let i = 0; i < vakatTimes.length; i++) {\n        let [hours, minutes] = vakatTimes[i].split(\":\").map(Number);\n        let vakatTime = new Date();\n        vakatTime.setHours(hours, minutes, 0, 0);\n        if (now < vakatTime) {\n            return { name: times[i], time: vakatTimes[i], icon: icons[i], vakatTime };\n        }\n    }\n    return { name: times[0], time: vakatTimes[0], icon: icons[0], vakatTime: new Date() };\n}\n\nasync function createWidget() {\n    let { data } = await getVaktija();\n    let nextVakat = getNextVakat(data.vakat);\n\n    let widget = new ListWidget();\n    widget.backgroundColor = new Color(\"#1e2227\");\n\n    let title = widget.addText(`${nextVakat.icon} ${nextVakat.name}`);\n    title.textColor = Color.white();\n    title.font = Font.boldSystemFont(16);\n    title.centerAlignText(); \n\n    widget.addSpacer(4);\n\n    let vakatText = widget.addText(`${nextVakat.time}`);\n    vakatText.textColor = new Color(\"#a59573\");\n    vakatText.font = Font.mediumSystemFont(18);\n    vakatText.centerAlignText(); \n\n    widget.refreshAfterDate = new Date(Date.now() + 1 * 1000);\n\n    return widget;\n}\n\nlet widget = await createWidget();\nif (config.runsInWidget) {\n    Script.setWidget(widget);\n} else {\n    widget.presentSmall();\n}\n\nScript.complete();",
  "share_sheet_inputs" : [

  ]
}